"use strict";!function(a){var e,n,i,s,r=1e3*ina_ajax.settings.timeout,u=0,c=ina_ajax.settings.countdown_timeout,_=ina_ajax.ajaxurl,m={onReady:function(){this.setupDOM(),this.eventListeners()},setupDOM:function(){},eventListeners:function(){n=sessionStorage.inactive_logout_tabID&&"2"!==sessionStorage.closedLastTab?sessionStorage.inactive_logout_tabID:sessionStorage.inactive_logout_tabID=Math.random(),sessionStorage.closedLastTab="2",window.addEventListener("beforeunload",function(o){sessionStorage.closedLastTab="1"}),localStorage.setItem("ina__browserTabID",n),a(document).on("mousemove",this.resetTimer.bind(this)),a(document).on("mousedown",this.resetTimer.bind(this)),a(document).on("keydown",this.resetTimer.bind(this)),a(document).on("DOMMouseScroll",this.resetTimer.bind(this)),a(document).on("mousewheel",this.resetTimer.bind(this)),a(document).on("touchmove",this.resetTimer.bind(this)),a(document).on("MSPointerMove",this.resetTimer.bind(this)),a(document).ready(this.resetTimer.bind(this)),a(document).on("click",".ina_stay_logged_in",this.stayLoggedInWarnMsg),a(document).on("click",".btn-close-without-reload",this.stayLoggedInWarnMsg),this.startTimer()},startTimer:function(){e=setTimeout(m.goInactive.bind(this),5e3)},resetTimer:function(){clearTimeout(e),clearTimeout(i),localStorage.setItem("ina__browserTabID",n);try{this.startTimer()}catch(o){TypeError,console.log(o,!0)}},goInactive:function(){var o,t=this;0===u&&(o=localStorage.getItem("ina__browserTabID"),parseFloat(o)===parseFloat(n)&&(o=Date.now(),o=Math.floor(o/1e3),o={action:"ina_checklastSession",do:"ina_updateLastSession",security:ina_ajax.ina_security,timestamp:o},a.post(_,o).done(function(o){if(!1!==o.success){var n=document.activeElement;if(n&&("IFRAME"===n.tagName||n.classList.contains("media-modal")))return t.resetTimer(),!1;i=setTimeout(function(){m.showTimeoutMessage(o)},r)}})))},showTimeoutMessage:function(n){var t,o=ina_ajax.settings.disable_countdown,e=ina_ajax.settings.warn_message_enabled;document.onkeydown=function(o){if(116!=(o.charCode||o.keyCode))return!1},window.oncontextmenu=function(){return!1},u=1,e?a("#ina__dp_logout_message_box").show().html(n.html):o?(o={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security},a.post(_,o).done(function(o){return o.redirect_url?(a("#ina__dp_logout_message_box").show().html(n.html),a("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+o.msg+"<p>"),m.logout_now(o.redirect_url)):(a("#ina__dp_logout_message_box").show().html(n.html),a("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+o.msg+"</p>"),m.logout_now(!1)),!1})):(c=ina_ajax.settings.countdown_timeout,a("#ina__dp_logout_message_box").show().html(n.html),s=setInterval(function(){var o;0<=c&&(t=c--,a(".ina_countdown").html("("+m.secondsToHms(t)+")")),0===t&&(clearTimeout(s),o={action:"ina_checklastSession",do:"ina_logout",security:ina_ajax.ina_security},a.post(_,o).done(function(o){return o.redirect_url?(a("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+o.msg+"<p>"),m.logout_now(o.redirect_url)):(a("#ina__dp_logout_message_box .ina-dp-noflict-modal-body").html("<p>"+o.msg+"</p>"),m.logout_now(!1)),!1}))},1e3))},stayLoggedInWarnMsg:function(){document.onkeydown=function(o){return!0},window.oncontextmenu=null,clearTimeout(s),c=ina_ajax.settings.countdown_timeout,u=0,a("#ina__dp_logout_message_box").hide(),a(".ina_countdown").text("")},logout_now:function(o){var t=this,n={action:"ina_logout_session",security:ina_ajax.ina_security};a.post(_,n).done(function(n){clearTimeout(e),localStorage.removeItem("ina__browserTabID"),o&&(window.location=o),document.onkeydown=function(o){return!0},a("form#ina-ajaxlogin-form").on("submit",function(o){a("form#ina-ajaxlogin-form .ina-login-status").show().text("* "+ina_ajax.i10n.login_wait+"..."),a.ajax({type:"POST",dataType:"json",url:ina_ajax.ajaxurl,data:{action:"ina_ajaxlogin",username:a("form#ina-ajaxlogin-form #ina-username").val(),password:a("form#ina-ajaxlogin-form #ina-password").val(),nonce:n.nonce},success:function(o){a(".ina-login-status").html(o.data.message),!0===o.success&&t.stayLoggedInWarnMsg()}}),o.preventDefault()}),console.log("Session Logged Out !!")})},secondsToHms:function(o){o=Number(o);var n=Math.floor(o/3600),t=Math.floor(o%3600/60),o=Math.floor(o%3600%60);return(0<n?n+(1==n?" "+ina_ajax.i10n.hour+", ":" "+ina_ajax.i10n.hours+", "):"")+(0<t?t+(1==t?" "+ina_ajax.i10n.minute+", ":" "+ina_ajax.i10n.minutes+", "):"")+(0<o?o+(1==o?" "+ina_ajax.i10n.second:" "+ina_ajax.i10n.seconds):"")}};a(function(){m.onReady()})}(jQuery);